<!-- Courses fields -->
<ng-container *ngSwitchCase="'courses'">
    <div class="mb-4">
        <label for="provider" class="block text-sm font-medium text-gray-700 mb-1">Nhà cung
            cấp</label>
        <app-elearning-text-box id="provider" formControlName="provider" placeholder="Ví dụ: Udacity, Coursera">
        </app-elearning-text-box>
    </div>

    <div class="mb-4">
        <label for="completionDate" class="block text-sm font-medium text-gray-700 mb-1">Ngày hoàn
            thành</label>
        <input type="date" id="completionDate" formControlName="completionDate"
            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
    </div>

    <div formArrayName="skills" class="mb-4">
        <div class="flex justify-between items-center mb-2">
            <label class="block text-sm font-medium text-gray-700">Kỹ năng thu được</label>
            <button type="button" (click)="addCourseSkill()" class="text-sm text-blue-600 hover:text-blue-800">
                + Thêm kỹ năng
            </button>
        </div>

        <div class="flex flex-wrap gap-2 mb-2">
            <div *ngFor="let skill of courseSkillsFormArray.controls; let i = index"
                class="inline-flex items-center bg-blue-100 text-blue-800 px-2 py-0.5 rounded text-xs">
                <input [formControlName]="i" class="bg-transparent border-none focus:outline-none focus:ring-0 w-20">
                <button type="button" (click)="removeCourseSkill(i)" class="ml-1 text-blue-500 hover:text-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </div>
    </div>
</ng-container>

<!-- Certificates fields -->
<ng-container *ngSwitchCase="'certificates'">
    <div class="mb-4">
        <label for="issuer" class="block text-sm font-medium text-gray-700 mb-1">Tổ chức cấp</label>
        <app-elearning-text-box id="issuer" formControlName="issuer" placeholder="Tên tổ chức cấp chứng chỉ">
        </app-elearning-text-box>
    </div>

    <div class="mb-4">
        <label for="credentialId" class="block text-sm font-medium text-gray-700 mb-1">Mã chứng
            chỉ</label>
        <app-elearning-text-box id="credentialId" formControlName="credentialId"
            placeholder="Mã định danh chứng chỉ (nếu có)">
        </app-elearning-text-box>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
        <div>
            <label for="issueDate" class="block text-sm font-medium text-gray-700 mb-1">Ngày
                cấp</label>
            <input type="date" id="issueDate" formControlName="issueDate"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
        </div>
        <div>
            <label for="expirationDate" class="block text-sm font-medium text-gray-700 mb-1">Ngày
                hết hạn</label>
            <input type="date" id="expirationDate" formControlName="expirationDate"
                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
        </div>
    </div>

    <div class="mb-4">
        <label for="certUrl" class="block text-sm font-medium text-gray-700 mb-1">URL xác
            thực</label>
        <app-elearning-text-box id="certUrl" formControlName="url"
            placeholder="Liên kết để xác thực chứng chỉ (nếu có)">
        </app-elearning-text-box>
    </div>
</ng-container>
</ng-container>

<!-- Common fields for all section types -->
<div class="mb-4">
    <label for="subtitle" class="block text-sm font-medium text-gray-700 mb-1">Phụ đề (nếu có)</label>
    <app-elearning-text-box id="subtitle" formControlName="subtitle" placeholder="Phụ đề hoặc thông tin bổ sung">
    </app-elearning-text-box>
</div>

<!-- Date range fields -->
<div *ngIf="currentSection?.type !== 'skills' && currentSection?.type !== 'courses' && currentSection?.type !== 'certificates'"
    class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
    <div>
        <label for="startDate" class="block text-sm font-medium text-gray-700 mb-1">Ngày bắt đầu</label>
        <input type="date" id="startDate" formControlName="startDate"
            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
    </div>
    <div>
        <div class="flex justify-between">
            <label for="endDate" class="block text-sm font-medium text-gray-700 mb-1">Ngày kết
                thúc</label>
            <label class="inline-flex items-center text-xs">
                <input type="checkbox" formControlName="isCurrent" class="form-checkbox h-3 w-3 text-blue-600">
                <span class="ml-1 text-gray-700">Hiện tại</span>
            </label>
        </div>
        <input type="date" id="endDate" formControlName="endDate" [disabled]="sectionItemForm.get('isCurrent')?.value"
            class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
            [ngClass]="{'bg-gray-100': sectionItemForm.get('isCurrent')?.value}">
    </div>
</div>

<div class="mb-4">
    <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Mô tả</label>
    <textarea id="description" formControlName="description" rows="3" placeholder="Mô tả chi tiết"
        class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
</div>

<div formArrayName="tags" class="mb-4">
    <div class="flex justify-between items-center mb-2">
        <label class="block text-sm font-medium text-gray-700">Thẻ</label>
        <button type="button" (click)="addTag()" class="text-sm text-blue-600 hover:text-blue-800">
            + Thêm thẻ
        </button>
    </div>

    <div class="flex flex-wrap gap-2 mb-2">
        <div *ngFor="let tag of tagsFormArray.controls; let i = index"
            class="inline-flex items-center bg-gray-100 text-gray-800 px-2 py-0.5 rounded text-xs">
            <input [formControlName]="i" class="bg-transparent border-none focus:outline-none focus:ring-0 w-20">
            <button type="button" (click)="removeTag(i)" class="ml-1 text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd"
                        d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
                        clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>
</div>

<div class="flex justify-end space-x-3">
    <app-elearning-button type="secondary" (click)="cancelSectionItemModal()">
        Hủy
    </app-elearning-button>
    <app-elearning-button type="primary" [disabled]="sectionItemForm.invalid || isLoading.saving" buttonType="submit">
        {{ editingItemIndex !== null ? 'Lưu thay đổi' : 'Thêm mục' }}
    </app-elearning-button>
</div>
</form>
</div>
</app-modal>
<!-- File path: src/app/features/profile/resume-builder/resume-builder.component.html -->

<div class="bg-gray-50 min-h-screen py-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900">Công cụ tạo CV</h1>
            <p class="mt-1 text-lg text-gray-500">
                Tạo CV chuyên nghiệp từ khóa học, chứng chỉ và kỹ năng của bạn
            </p>
        </div>

        <div class="flex flex-col lg:flex-row gap-6">
            <!-- Sidebar -->
            <div class="w-full lg:w-64 flex-shrink-0">
                <div class="bg-white shadow rounded-lg p-4 mb-6">
                    <h3 class="text-lg font-medium text-gray-900 mb-3">CV của tôi</h3>

                    <!-- Loading state -->
                    <div *ngIf="isLoading.resumes" class="py-4 flex justify-center">
                        <app-loader size="sm"></app-loader>
                    </div>

                    <!-- Error state -->
                    <div *ngIf="errors.resumes" class="p-2 text-sm text-red-600">
                        {{ errors.resumes }}
                        <button (click)="loadResumes()" class="ml-2 text-blue-600 hover:underline">
                            Thử lại
                        </button>
                    </div>

                    <!-- Empty state -->
                    <div *ngIf="!isLoading.resumes && !errors.resumes && resumes.length === 0" class="py-4 text-center">
                        <p class="text-sm text-gray-500">Bạn chưa có CV nào</p>
                        <app-elearning-button type="primary" (click)="showNewResumeModal = true" class="mt-3" size="sm">
                            Tạo CV mới
                        </app-elearning-button>
                    </div>

                    <!-- Resume list -->
                    <div *ngIf="!isLoading.resumes && !errors.resumes && resumes.length > 0" class="space-y-2">
                        <div *ngFor="let resume of resumes" [class.bg-blue-50]="currentResume?.id === resume.id"
                            class="p-2 rounded-md hover:bg-gray-50 cursor-pointer border border-gray-200"
                            (click)="loadResume(resume.id!)">
                            <div class="flex justify-between items-center">
                                <span class="text-sm font-medium text-gray-900">{{ resume.title }}</span>
                                <div class="flex items-center">
                                    <button (click)="$event.stopPropagation(); confirmDeleteResume(resume.id!)"
                                        class="text-gray-400 hover:text-red-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20"
                                            fill="currentColor">
                                            <path fill-rule="evenodd"
                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                clip-rule="evenodd" />
                                        </svg>
                                    </button>
                                </div>

                                <div class="bg-gray-50 rounded-lg p-4">
                                    <!-- Section items list -->
                                    <div *ngIf="section.items.length === 0" class="py-6 text-center">
                                        <p class="text-sm text-gray-500">Chưa có mục nào trong phần này</p>
                                        <app-elearning-button type="secondary" (click)="addSectionItem(section)"
                                            class="mt-3" size="sm">
                                            Thêm mục mới
                                        </app-elearning-button>
                                    </div>

                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <!-- Section items list -->
                                        <div *ngIf="section.items.length === 0" class="py-6 text-center">
                                            <p class="text-sm text-gray-500">Chưa có mục nào trong phần này</p>
                                            <app-elearning-button type="secondary" (click)="addSectionItem(section)"
                                                class="mt-3" size="sm">
                                                Thêm mục mới
                                            </app-elearning-button>
                                        </div>

                                        <div *ngIf="section.items.length > 0" cdkDropList
                                            (cdkDropListDropped)="dropSectionItem(section, $event)">
                                            <div *ngFor="let item of section.items; let itemIndex = index"
                                                class="border border-gray-200 bg-white rounded-lg mb-3 p-3" cdkDrag>
                                                <!-- Item content based on section type -->
                                                <div [ngSwitch]="section.type">
                                                    <!-- Education -->
                                                    <div *ngSwitchCase="'education'" class="flex items-start">
                                                        <div class="flex-grow">
                                                            <div class="flex justify-between items-start">
                                                                <div>
                                                                    <h4 class="font-medium text-gray-900">{{ item.title
                                                                        }}
                                                                    </h4>
                                                                    <p class="text-sm text-gray-600">{{ item.institution
                                                                        ||
                                                                        item.subtitle }}</p>
                                                                    <!-- Certificates -->
                                                                    <div *ngSwitchCase="'certificates'"
                                                                        class="flex items-start">
                                                                        <div class="flex-grow">
                                                                            <h4 class="font-medium text-gray-900">{{
                                                                                item.title }}</h4>
                                                                            <p class="text-sm text-gray-600">{{
                                                                                item.issuer }}</p>
                                                                            <div
                                                                                class="flex items-center text-xs text-gray-500 mt-1">
                                                                                <span>Cấp ngày: {{ item.issueDate |
                                                                                    date:'dd/MM/yyyy' }}</span>
                                                                                <span *ngIf="item.expirationDate"
                                                                                    class="ml-4">
                                                                                    Hết hạn: {{ item.expirationDate |
                                                                                    date:'dd/MM/yyyy' }}
                                                                                </span>
                                                                            </div>
                                                                            <p *ngIf="item.credentialId"
                                                                                class="text-xs text-gray-500 mt-1">
                                                                                Mã chứng chỉ: {{ item.credentialId }}
                                                                            </p>
                                                                            <div *ngIf="item.url" class="mt-1">
                                                                                <a [href]="item.url" target="_blank"
                                                                                    class="text-sm text-blue-600 hover:underline">Xem
                                                                                    chứng
                                                                                    chỉ</a>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center ml-2">
                                                                            <button
                                                                                (click)="editSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-blue-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path
                                                                                        d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                                                </svg>
                                                                            </button>
                                                                            <button
                                                                                (click)="deleteSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-red-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path fill-rule="evenodd"
                                                                                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                                        clip-rule="evenodd" />
                                                                                </svg>
                                                                            </button>
                                                                            <div class="cursor-move ml-1" cdkDragHandle>
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4 text-gray-400"
                                                                                    fill="none" viewBox="0 0 24 24"
                                                                                    stroke="currentColor">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"
                                                                                        d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                                                </svg>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Custom -->
                                                                    <div *ngSwitchCase="'custom'"
                                                                        class="flex items-start">
                                                                        <div class="flex-grow">
                                                                            <h4 class="font-medium text-gray-900">{{
                                                                                item.title }}</h4>
                                                                            <p *ngIf="item.subtitle"
                                                                                class="text-sm text-gray-600">{{
                                                                                item.subtitle }}</p>
                                                                            <p *ngIf="item.description"
                                                                                class="text-sm text-gray-600 mt-1">
                                                                                {{ item.description }}</p>
                                                                            <div *ngIf="item.tags && item.tags.length > 0"
                                                                                class="flex flex-wrap gap-1 mt-2">
                                                                                <span *ngFor="let tag of item.tags"
                                                                                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                                                    {{ tag }}
                                                                                </span>
                                                                            </div>
                                                                        </div>
                                                                        <div class="flex items-center ml-2">
                                                                            <button
                                                                                (click)="editSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-blue-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path
                                                                                        d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                                                </svg>
                                                                            </button>
                                                                            <button
                                                                                (click)="deleteSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-red-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path fill-rule="evenodd"
                                                                                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                                        clip-rule="evenodd" />
                                                                                </svg>
                                                                            </button>
                                                                            <div class="cursor-move ml-1" cdkDragHandle>
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4 text-gray-400"
                                                                                    fill="none" viewBox="0 0 24 24"
                                                                                    stroke="currentColor">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"
                                                                                        d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                                                </svg>
                                                                            </div>
                                                                        </div>
                                                                    </div>

                                                                    <!-- Default item display -->
                                                                    <div *ngSwitchDefault class="flex items-start">
                                                                        <div class="flex-grow">
                                                                            <h4 class="font-medium text-gray-900">{{
                                                                                item.title }}</h4>
                                                                            <p *ngIf="item.subtitle"
                                                                                class="text-sm text-gray-600">{{
                                                                                item.subtitle }}</p>
                                                                            <p *ngIf="item.description"
                                                                                class="text-sm text-gray-600 mt-1">
                                                                                {{ item.description }}</p>
                                                                        </div>
                                                                        <div class="flex items-center ml-2">
                                                                            <button
                                                                                (click)="editSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-blue-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path
                                                                                        d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                                                </svg>
                                                                            </button>
                                                                            <button
                                                                                (click)="deleteSectionItem(section, itemIndex)"
                                                                                class="text-gray-400 hover:text-red-500 p-1">
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4" viewBox="0 0 20 20"
                                                                                    fill="currentColor">
                                                                                    <path fill-rule="evenodd"
                                                                                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                                        clip-rule="evenodd" />
                                                                                </svg>
                                                                            </button>
                                                                            <div class="cursor-move ml-1" cdkDragHandle>
                                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                                    class="h-4 w-4 text-gray-400"
                                                                                    fill="none" viewBox="0 0 24 24"
                                                                                    stroke="currentColor">
                                                                                    <path stroke-linecap="round"
                                                                                        stroke-linejoin="round"
                                                                                        stroke-width="2"
                                                                                        d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                                                </svg>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>

                                                        <div class="mt-3 flex justify-end">
                                                            <app-elearning-button type="secondary"
                                                                (click)="addSectionItem(section)" icon="plus"
                                                                iconPosition="left" size="sm">
                                                                Thêm mục mới
                                                            </app-elearning-button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            </ng-container>

                                            <div class="mt-6 flex justify-end">
                                                <app-elearning-button type="primary" (click)="saveCurrentResume()"
                                                    [disabled]="personalInfoForm.invalid || contactInfoForm.invalid || resumeDetailsForm.invalid || isLoading.saving">
                                                    <span *ngIf="!isLoading.saving">Lưu CV</span>
                                                    <span *ngIf="isLoading.saving">Đang lưu...</span>
                                                </app-elearning-button>
                                            </div>
                                        </div>

                                        <!-- Resume Preview Tab -->
                                        <div *ngIf="activeTab === 'preview'" class="p-6">
                                            <div class="mb-6 flex justify-between items-center">
                                                <h3 class="text-lg font-medium text-gray-900">Xem trước CV</h3>
                                                <div class="flex space-x-2">
                                                    <app-elearning-button type="secondary"
                                                        (click)="switchTab('content')" icon="pencil" iconPosition="left"
                                                        size="sm">
                                                        Chỉnh sửa
                                                    </app-elearning-button>
                                                    <app-elearning-button type="primary" (click)="switchTab('export')"
                                                        icon="download" iconPosition="left" size="sm">
                                                        Xuất CV
                                                    </app-elearning-button>
                                                </div>
                                            </div>

                                            <!-- Preview iframe -->
                                            <div class="border border-gray-200 rounded-lg overflow-hidden">
                                                <div
                                                    class="p-2 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
                                                    <div class="flex space-x-2">
                                                        <div class="w-3 h-3 rounded-full bg-red-500"></div>
                                                        <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                                                        <div class="w-3 h-3 rounded-full bg-green-500"></div>
                                                    </div>
                                                    <span class="text-xs text-gray-500">Xem trước CV</span>
                                                    <div></div>
                                                </div>
                                                <div class="bg-white">
                                                    <iframe id="resume-preview" frameBorder="0"
                                                        class="w-full h-[800px]"></iframe>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Export Tab -->
                                        <div *ngIf="activeTab === 'export'" class="p-6">
                                            <div class="mb-6">
                                                <h3 class="text-lg font-medium text-gray-900 mb-2">Xuất CV</h3>
                                                <p class="text-sm text-gray-600">
                                                    Tải CV của bạn dưới dạng PDF, DOCX hoặc định dạng khác để chia sẻ
                                                    hoặc in ấn.
                                                </p>
                                            </div>

                                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                                <!-- PDF Export -->
                                                <div
                                                    class="border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
                                                    <div class="flex items-center mb-4">
                                                        <div
                                                            class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                class="h-6 w-6 text-red-500" fill="none"
                                                                viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                                    stroke-width="2"
                                                                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">PDF</h4>
                                                            <p class="text-xs text-gray-500">Định dạng phổ biến nhất cho
                                                                CV</p>
                                                        </div>
                                                    </div>
                                                    <app-elearning-button type="primary" (click)="exportResume('pdf')"
                                                        [disabled]="isLoading.exporting" class="w-full">
                                                        <span *ngIf="!isLoading.exporting">Xuất PDF</span>
                                                        <span *ngIf="isLoading.exporting">Đang xuất...</span>
                                                    </app-elearning-button>
                                                </div>

                                                <!-- DOCX Export -->
                                                <div
                                                    class="border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
                                                    <div class="flex items-center mb-4">
                                                        <div
                                                            class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                class="h-6 w-6 text-blue-500" fill="none"
                                                                viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                                    stroke-width="2"
                                                                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">Word (DOCX)</h4>
                                                            <p class="text-xs text-gray-500">Định dạng có thể chỉnh sửa
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <app-elearning-button type="primary" (click)="exportResume('docx')"
                                                        [disabled]="isLoading.exporting" class="w-full">
                                                        <span *ngIf="!isLoading.exporting">Xuất DOCX</span>
                                                        <span *ngIf="isLoading.exporting">Đang xuất...</span>
                                                    </app-elearning-button>
                                                </div>

                                                <!-- Plain Text Export -->
                                                <div
                                                    class="border border-gray-200 rounded-lg p-4 bg-white hover:shadow-md transition-shadow">
                                                    <div class="flex items-center mb-4">
                                                        <div
                                                            class="w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mr-4">
                                                            <svg xmlns="http://www.w3.org/2000/svg"
                                                                class="h-6 w-6 text-gray-500" fill="none"
                                                                viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round"
                                                                    stroke-width="2"
                                                                    d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                                            </svg>
                                                        </div>
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">Văn bản thuần (TXT)
                                                            </h4>
                                                            <p class="text-xs text-gray-500">Định dạng văn bản đơn giản
                                                            </p>
                                                        </div>
                                                    </div>
                                                    <app-elearning-button type="primary" (click)="exportResume('txt')"
                                                        [disabled]="isLoading.exporting" class="w-full">
                                                        <span *ngIf="!isLoading.exporting">Xuất TXT</span>
                                                        <span *ngIf="isLoading.exporting">Đang xuất...</span>
                                                    </app-elearning-button>
                                                </div>
                                            </div>

                                            <div class="mt-8">
                                                <h3 class="text-lg font-medium text-gray-900 mb-4">Tùy chọn xuất</h3>
                                                <div class="bg-gray-50 rounded-lg p-4">
                                                    <div class="space-y-4">
                                                        <div>
                                                            <label class="flex items-center">
                                                                <input type="checkbox"
                                                                    class="form-checkbox h-4 w-4 text-blue-600"
                                                                    [(ngModel)]="exportOptions.includePhoto">
                                                                <span class="ml-2 text-sm text-gray-700">Bao gồm ảnh đại
                                                                    diện</span>
                                                            </label>
                                                        </div>

                                                        <div>
                                                            <label for="colorScheme"
                                                                class="block text-sm font-medium text-gray-700 mb-1">Bảng
                                                                màu</label>
                                                            <select id="colorScheme"
                                                                [(ngModel)]="exportOptions.colorScheme"
                                                                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                                                <option value="blue">Xanh dương</option>
                                                                <option value="green">Xanh lá</option>
                                                                <option value="red">Đỏ</option>
                                                                <option value="purple">Tím</option>
                                                                <option value="gray">Xám</option>
                                                                <option value="monochrome">Đơn sắc</option>
                                                            </select>
                                                        </div>

                                                        <div>
                                                            <label for="fontFamily"
                                                                class="block text-sm font-medium text-gray-700 mb-1">Font
                                                                chữ</label>
                                                            <select id="fontFamily"
                                                                [(ngModel)]="exportOptions.fontFamily"
                                                                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                                                <option value="arial">Arial</option>
                                                                <option value="roboto">Roboto</option>
                                                                <option value="opensans">Open Sans</option>
                                                                <option value="times">Times New Roman</option>
                                                                <option value="georgia">Georgia</option>
                                                            </select>
                                                        </div>

                                                        <div>
                                                            <label for="fontSize"
                                                                class="block text-sm font-medium text-gray-700 mb-1">Kích
                                                                thước chữ</label>
                                                            <select id="fontSize" [(ngModel)]="exportOptions.fontSize"
                                                                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                                                <option value="small">Nhỏ</option>
                                                                <option value="medium">Trung bình</option>
                                                                <option value="large">Lớn</option>
                                                            </select>
                                                        </div>
                                                        <div class="text-sm text-gray-500">
                                                            {{ item.startDate | date:'MM/yyyy' }} - {{
                                                            item.isCurrent ? 'Hiện tại' : (item.endDate |
                                                            date:'MM/yyyy') }}
                                                        </div>
                                                    </div>
                                                    <p *ngIf="item.degree"
                                                        class="text-sm font-medium text-gray-700 mt-1">{{
                                                        item.degree }}</p>
                                                    <p *ngIf="item.fieldOfStudy" class="text-sm text-gray-600">{{
                                                        item.fieldOfStudy }}</p>
                                                    <p *ngIf="item.description" class="text-sm text-gray-600 mt-1">
                                                        {{ item.description }}</p>
                                                </div>
                                                <div class="flex items-center ml-2">
                                                    <button (click)="editSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-blue-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path
                                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-red-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd"
                                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                    <div class="cursor-move ml-1" cdkDragHandle>
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            class="h-4 w-4 text-gray-400" fill="none"
                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Experience -->
                                            <div *ngSwitchCase="'experience'" class="flex items-start">
                                                <div class="flex-grow">
                                                    <div class="flex justify-between items-start">
                                                        <div>
                                                            <h4 class="font-medium text-gray-900">{{ item.position
                                                                || item.title }}</h4>
                                                            <p class="text-sm text-gray-600">{{ item.company ||
                                                                item.subtitle }}</p>
                                                        </div>
                                                        <div class="text-sm text-gray-500">
                                                            {{ item.startDate | date:'MM/yyyy' }} - {{
                                                            item.isCurrent ? 'Hiện tại' : (item.endDate |
                                                            date:'MM/yyyy') }}
                                                        </div>
                                                    </div>
                                                    <p *ngIf="item.description" class="text-sm text-gray-600 mt-1">
                                                        {{ item.description }}</p>
                                                    <ul *ngIf="item.responsibilities && item.responsibilities.length > 0"
                                                        class="list-disc list-inside text-sm text-gray-600 mt-1 space-y-1">
                                                        <li *ngFor="let responsibility of item.responsibilities">{{
                                                            responsibility }}</li>
                                                    </ul>
                                                </div>
                                                <div class="flex items-center ml-2">
                                                    <button (click)="editSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-blue-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path
                                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-red-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd"
                                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                    <div class="cursor-move ml-1" cdkDragHandle>
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            class="h-4 w-4 text-gray-400" fill="none"
                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Skills -->
                                            <div *ngSwitchCase="'skills'" class="flex items-start">
                                                <div class="flex-grow">
                                                    <h4 class="font-medium text-gray-900">{{ item.title }}</h4>
                                                    <div *ngIf="item.proficiency" class="mt-1">
                                                        <div class="w-full bg-gray-200 rounded-full h-1.5">
                                                            <div class="bg-blue-500 h-1.5 rounded-full"
                                                                [style.width]="item.proficiency + '%'"></div>
                                                        </div>
                                                    </div>
                                                    <p *ngIf="item.category" class="text-xs text-gray-500 mt-1">{{
                                                        item.category }}</p>
                                                </div>
                                                <div class="flex items-center ml-2">
                                                    <button (click)="editSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-blue-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path
                                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-red-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd"
                                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                    <div class="cursor-move ml-1" cdkDragHandle>
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            class="h-4 w-4 text-gray-400" fill="none"
                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Projects -->
                                            <div *ngSwitchCase="'projects'" class="flex items-start">
                                                <div class="flex-grow">
                                                    <div class="flex justify-between items-start">
                                                        <h4 class="font-medium text-gray-900">{{ item.title }}</h4>
                                                        <div *ngIf="item.startDate" class="text-sm text-gray-500">
                                                            {{ item.startDate | date:'MM/yyyy' }} - {{
                                                            item.isCurrent ? 'Hiện tại' : (item.endDate |
                                                            date:'MM/yyyy') }}
                                                        </div>
                                                    </div>
                                                    <p *ngIf="item.role" class="text-sm font-medium text-gray-700 mt-1">
                                                        {{ item.role
                                                        }}</p>
                                                    <p *ngIf="item.description" class="text-sm text-gray-600 mt-1">
                                                        {{ item.description }}</p>
                                                    <div *ngIf="item.technologies && item.technologies.length > 0"
                                                        class="flex flex-wrap gap-1 mt-2">
                                                        <span *ngFor="let tech of item.technologies"
                                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                            {{ tech }}
                                                        </span>
                                                    </div>
                                                    <div *ngIf="item.url" class="mt-1">
                                                        <a [href]="item.url" target="_blank"
                                                            class="text-sm text-blue-600 hover:underline">{{
                                                            item.url }}</a>
                                                    </div>
                                                </div>
                                                <div class="flex items-center ml-2">
                                                    <button (click)="editSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-blue-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path
                                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-red-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd"
                                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                    <div class="cursor-move ml-1" cdkDragHandle>
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            class="h-4 w-4 text-gray-400" fill="none"
                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Courses -->
                                            <div *ngSwitchCase="'courses'" class="flex items-start">
                                                <div class="flex-grow">
                                                    <h4 class="font-medium text-gray-900">{{ item.title }}</h4>
                                                    <p class="text-sm text-gray-600">{{ item.provider }}</p>
                                                    <p *ngIf="item.completionDate" class="text-xs text-gray-500 mt-1">
                                                        Hoàn thành: {{ item.completionDate | date:'dd/MM/yyyy' }}
                                                    </p>
                                                    <div *ngIf="item.skills && item.skills.length > 0"
                                                        class="flex flex-wrap gap-1 mt-2">
                                                        <span *ngFor="let skill of item.skills"
                                                            class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                            {{ skill }}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="flex items-center ml-2">
                                                    <button (click)="editSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-blue-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path
                                                                d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                        </svg>
                                                    </button>
                                                    <button (click)="deleteSectionItem(section, itemIndex)"
                                                        class="text-gray-400 hover:text-red-500 p-1">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                            viewBox="0 0 20 20" fill="currentColor">
                                                            <path fill-rule="evenodd"
                                                                d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                clip-rule="evenodd" />
                                                        </svg>
                                                    </button>
                                                    <div class="cursor-move ml-1" cdkDragHandle>
                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                            class="h-4 w-4 text-gray-400" fill="none"
                                                            viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                                stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                        </svg>
                                                    </div>
                                                </div>
                                            </div>

                                            <div *ngIf="section.items.length > 0" cdkDropList
                                                (cdkDropListDropped)="dropSectionItem(section, $event)">
                                                <div *ngFor="let item of section.items; let itemIndex = index"
                                                    class="border border-gray-200 bg-white rounded-lg mb-3 p-3" cdkDrag>
                                                    <div class="flex items-start">
                                                        <div class="flex-grow">
                                                            <div class="flex items-center mb-1">
                                                                <h4 class="font-medium text-gray-900">{{ item.title }}
                                                                </h4>
                                                                <span *ngIf="item.subtitle"
                                                                    class="ml-2 text-sm text-gray-500">{{
                                                                    item.subtitle }}</span>
                                                                <span *ngIf="item.startDate"
                                                                    class="ml-auto text-sm text-gray-500">
                                                                    {{ item.startDate | date:'MM/yyyy' }} - {{
                                                                    item.isCurrent ?
                                                                    'Hiện tại' : (item.endDate | date:'MM/yyyy') }}
                                                                </span>
                                                            </div>
                                                            <p *ngIf="item.description"
                                                                class="text-sm text-gray-600 mb-2">{{
                                                                item.description }}</p>
                                                            <div *ngIf="item.tags && item.tags.length > 0"
                                                                class="flex flex-wrap gap-1 mt-2">
                                                                <span *ngFor="let tag of item.tags"
                                                                    class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                                                    {{ tag }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                        <div class="flex items-center ml-2">
                                                            <button (click)="editSectionItem(section, itemIndex)"
                                                                class="text-gray-400 hover:text-blue-500 p-1">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                                    viewBox="0 0 20 20" fill="currentColor">
                                                                    <path
                                                                        d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                                </svg>
                                                            </button>
                                                            <button (click)="deleteSectionItem(section, itemIndex)"
                                                                class="text-gray-400 hover:text-red-500 p-1">
                                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                                    viewBox="0 0 20 20" fill="currentColor">
                                                                    <path fill-rule="evenodd"
                                                                        d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                        clip-rule="evenodd" />
                                                                </svg>
                                                            </button>
                                                            <div class="cursor-move ml-1" cdkDragHandle>
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                    class="h-4 w-4 text-gray-400" fill="none"
                                                                    viewBox="0 0 24 24" stroke="currentColor">
                                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                                        stroke-width="2"
                                                                        d="M8 9l4-4 4 4m0 6l-4 4-4-4" />
                                                                </svg>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="mt-3 flex justify-end">
                                                <app-elearning-button type="secondary" (click)="addSectionItem(section)"
                                                    icon="plus" iconPosition="left" size="sm">
                                                    Thêm mục mới
                                                </app-elearning-button>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500">
                                        Cập nhật: {{ resume.updatedAt | date:'dd/MM/yyyy HH:mm' }}
                                    </p>
                                </div>

                                <div class="pt-2">
                                    <app-elearning-button type="secondary" (click)="showNewResumeModal = true" size="sm"
                                        class="w-full">
                                        Tạo CV mới
                                    </app-elearning-button>
                                </div>
                            </div>
                        </div>

                        <div *ngIf="currentResume" class="bg-white shadow rounded-lg p-4">
                            <h3 class="text-lg font-medium text-gray-900 mb-3">Công cụ</h3>
                            <div class="space-y-2">
                                <app-elearning-button type="primary" (click)="generateResumeFromUserData()"
                                    [disabled]="isLoading.generating" icon="refresh" iconPosition="left" size="sm"
                                    class="w-full">
                                    <span *ngIf="!isLoading.generating">Tự động điền</span>
                                    <span *ngIf="isLoading.generating">Đang tạo...</span>
                                </app-elearning-button>

                                <app-elearning-button type="secondary" (click)="switchTab('export')" icon="download"
                                    iconPosition="left" size="sm" class="w-full">
                                    Xuất CV
                                </app-elearning-button>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="flex-grow">
                        <!-- No resume selected state -->
                        <div *ngIf="!currentResume && !isLoading.currentResume"
                            class="bg-white shadow rounded-lg p-8 text-center">
                            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            <h3 class="mt-2 text-sm font-medium text-gray-900">Chưa có CV nào được chọn</h3>
                            <p class="mt-1 text-sm text-gray-500">
                                Hãy chọn một CV có sẵn hoặc tạo CV mới để bắt đầu
                            </p>
                            <div class="mt-6">
                                <app-elearning-button type="primary" (click)="showNewResumeModal = true">
                                    Tạo CV mới
                                </app-elearning-button>
                            </div>
                        </div>

                        <!-- Loading state -->
                        <div *ngIf="isLoading.currentResume" class="bg-white shadow rounded-lg p-8">
                            <div class="flex justify-center">
                                <app-loader message="Đang tải CV..."></app-loader>
                            </div>
                        </div>

                        <!-- Error state -->
                        <div *ngIf="!isLoading.currentResume && errors.currentResume"
                            class="bg-white shadow rounded-lg p-6 text-red-600">
                            <div class="flex items-center">
                                <svg class="h-5 w-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd"
                                        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                                        clip-rule="evenodd" />
                                </svg>
                                {{ errors.currentResume }}
                            </div>
                            <app-elearning-button type="secondary" (click)="loadResume(currentResume!.id!)" class="mt-4"
                                size="sm">
                                Thử lại
                            </app-elearning-button>
                        </div>

                        <!-- Resume Editor -->
                        <div *ngIf="currentResume && !isLoading.currentResume && !errors.currentResume"
                            class="bg-white shadow rounded-lg overflow-hidden">
                            <!-- Tabs -->
                            <div class="border-b border-gray-200">
                                <div class="flex -mb-px">
                                    <button (click)="activeTab = 'details'"
                                        class="px-4 py-2 border-b-2 font-medium text-sm mr-4"
                                        [ngClass]="activeTab === 'details' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                                        Chi tiết CV
                                    </button>
                                    <button (click)="activeTab = 'content'"
                                        class="px-4 py-2 border-b-2 font-medium text-sm mr-4"
                                        [ngClass]="activeTab === 'content' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                                        Nội dung
                                    </button>
                                    <button (click)="activeTab = 'preview'"
                                        class="px-4 py-2 border-b-2 font-medium text-sm"
                                        [ngClass]="activeTab === 'preview' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                                        Xem trước
                                    </button>
                                    <button (click)="activeTab = 'export'"
                                        class="px-4 py-2 border-b-2 font-medium text-sm"
                                        [ngClass]="activeTab === 'export' ? 'border-blue-500 text-blue-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'">
                                        Xuất CV
                                    </button>
                                </div>
                            </div>

                            <!-- Resume Details Tab -->
                            <div *ngIf="activeTab === 'details'" class="p-6">
                                <form [formGroup]="resumeDetailsForm">
                                    <div class="mb-6">
                                        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Tiêu đề
                                            CV</label>
                                        <app-elearning-text-box id="title" formControlName="title"
                                            placeholder="Nhập tiêu đề CV" [error]="resumeDetailsForm.get('title')?.invalid && resumeDetailsForm.get('title')?.touched ? 
    'Tiêu đề CV là bắt buộc và tối đa 100 ký tự' : ''">
                                        </app-elearning-text-box>
                                    </div>

                                    <!-- Template Selection -->
                                    <div class="mb-6">
                                        <h3 class="text-lg font-medium text-gray-900 mb-3">Chọn mẫu CV</h3>

                                        <!-- Loading templates -->
                                        <div *ngIf="isLoading.templates" class="py-4 flex justify-center">
                                            <app-loader size="sm"></app-loader>
                                        </div>

                                        <!-- Error loading templates -->
                                        <div *ngIf="errors.templates" class="p-2 text-sm text-red-600">
                                            {{ errors.templates }}
                                            <button (click)="loadResumeTemplates()"
                                                class="ml-2 text-blue-600 hover:underline">
                                                Thử lại
                                            </button>
                                        </div>

                                        <!-- Templates list -->
                                        <div *ngIf="!isLoading.templates && !errors.templates"
                                            class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            <div *ngFor="let template of resumeTemplates"
                                                class="border rounded-lg overflow-hidden cursor-pointer transition-all"
                                                [class.border-blue-500]="resumeDetailsForm.get('templateId')?.value === template.id"
                                                [class.border-gray-200]="resumeDetailsForm.get('templateId')?.value !== template.id"
                                                (click)="resumeDetailsForm.get('templateId')?.setValue(template.id)">
                                                <div class="h-40 bg-gray-100 overflow-hidden">
                                                    <img [src]="template.previewImage" [alt]="template.name"
                                                        class="w-full h-full object-cover">
                                                </div>
                                                <div class="p-3">
                                                    <div class="flex justify-between items-center">
                                                        <h4 class="font-medium text-gray-900">{{ template.name }}</h4>
                                                        <span *ngIf="template.isPremium"
                                                            class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full">
                                                            Premium
                                                        </span>
                                                    </div>
                                                    <p class="text-xs text-gray-500 mt-1">{{ template.description }}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="flex justify-end">
                                        <app-elearning-button type="primary" (click)="saveCurrentResume()"
                                            [disabled]="resumeDetailsForm.invalid || isLoading.saving">
                                            <span *ngIf="!isLoading.saving">Lưu thay đổi</span>
                                            <span *ngIf="isLoading.saving">Đang lưu...</span>
                                        </app-elearning-button>
                                    </div>
                                </form>
                            </div>

                            <!-- Resume Content Tab -->
                            <div *ngIf="activeTab === 'content'" class="p-6">
                                <!-- Section tabs -->
                                <div class="mb-6 overflow-x-auto">
                                    <div class="flex space-x-2 pb-2">
                                        <button (click)="activeSectionTab = 'personal'"
                                            class="px-3 py-1 text-sm rounded-md whitespace-nowrap" [ngClass]="activeSectionTab === 'personal' ? 
    'bg-blue-100 text-blue-700 font-medium' : 
    'text-gray-600 hover:bg-gray-100'">
                                            Thông tin cá nhân
                                        </button>
                                        <button (click)="activeSectionTab = 'all'"
                                            class="px-3 py-1 text-sm rounded-md whitespace-nowrap" [ngClass]="activeSectionTab === 'all' ? 
    'bg-blue-100 text-blue-700 font-medium' : 
    'text-gray-600 hover:bg-gray-100'">
                                            Tất cả phần
                                        </button>
                                        <button *ngFor="let section of currentResume.sections"
                                            (click)="activeSectionTab = section.type"
                                            class="px-3 py-1 text-sm rounded-md whitespace-nowrap" [ngClass]="activeSectionTab === section.type ? 
    'bg-blue-100 text-blue-700 font-medium' : 
    'text-gray-600 hover:bg-gray-100'">
                                            {{ section.title }}
                                        </button>
                                        <button (click)="showAddSectionModal()"
                                            class="px-3 py-1 text-sm rounded-md whitespace-nowrap text-blue-600 border border-blue-200 hover:bg-blue-50">
                                            + Thêm phần
                                        </button>
                                    </div>
                                </div>

                                <!-- Personal Information -->
                                <div *ngIf="activeSectionTab === 'personal' || activeSectionTab === 'all'" class="mb-8">
                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-medium text-gray-900">Thông tin cá nhân</h3>
                                    </div>

                                    <div class="bg-gray-50 rounded-lg p-4 mb-6">
                                        <form [formGroup]="personalInfoForm" class="space-y-4">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label for="firstName"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Họ</label>
                                                    <app-elearning-text-box id="firstName" formControlName="firstName"
                                                        placeholder="Nhập họ" [error]="personalInfoForm.get('firstName')?.invalid && personalInfoForm.get('firstName')?.touched ? 
          'Họ là bắt buộc và tối đa 50 ký tự' : ''">
                                                    </app-elearning-text-box>
                                                </div>
                                                <div>
                                                    <label for="lastName"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Tên</label>
                                                    <app-elearning-text-box id="lastName" formControlName="lastName"
                                                        placeholder="Nhập tên" [error]="personalInfoForm.get('lastName')?.invalid && personalInfoForm.get('lastName')?.touched ? 
          'Tên là bắt buộc và tối đa 50 ký tự' : ''">
                                                    </app-elearning-text-box>
                                                </div>
                                            </div>

                                            <div>
                                                <label for="jobTitle"
                                                    class="block text-sm font-medium text-gray-700 mb-1">Chức
                                                    danh</label>
                                                <app-elearning-text-box id="jobTitle" formControlName="jobTitle"
                                                    placeholder="Ví dụ: Front-end Developer" [error]="personalInfoForm.get('jobTitle')?.invalid && personalInfoForm.get('jobTitle')?.touched ? 
        'Chức danh là bắt buộc và tối đa 100 ký tự' : ''">
                                                </app-elearning-text-box>
                                            </div>

                                            <div>
                                                <label for="photo"
                                                    class="block text-sm font-medium text-gray-700 mb-1">Ảnh đại
                                                    diện (URL)</label>
                                                <app-elearning-text-box id="photo" formControlName="photo"
                                                    placeholder="Nhập URL ảnh đại diện">
                                                </app-elearning-text-box>
                                                <p class="text-xs text-gray-500 mt-1">Để trống nếu bạn không muốn hiển
                                                    thị ảnh
                                                </p>
                                            </div>
                                        </form>
                                    </div>

                                    <div class="flex justify-between items-center mb-4">
                                        <h3 class="text-lg font-medium text-gray-900">Thông tin liên hệ</h3>
                                    </div>

                                    <div class="bg-gray-50 rounded-lg p-4">
                                        <form [formGroup]="contactInfoForm" class="space-y-4">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label for="email"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                                                    <app-elearning-text-box id="email" formControlName="email"
                                                        placeholder="Nhập địa chỉ email" [error]="contactInfoForm.get('email')?.invalid && contactInfoForm.get('email')?.touched ? 
          'Email không hợp lệ' : ''">
                                                    </app-elearning-text-box>
                                                </div>
                                                <div>
                                                    <label for="phone"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Số điện
                                                        thoại</label>
                                                    <app-elearning-text-box id="phone" formControlName="phone"
                                                        placeholder="Nhập số điện thoại" [error]="contactInfoForm.get('phone')?.invalid && contactInfoForm.get('phone')?.touched ? 
          'Số điện thoại không hợp lệ' : ''">
                                                    </app-elearning-text-box>
                                                </div>
                                            </div>

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                <div>
                                                    <label for="location"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Địa
                                                        điểm</label>
                                                    <app-elearning-text-box id="location" formControlName="location"
                                                        placeholder="Ví dụ: Hà Nội, Việt Nam">
                                                    </app-elearning-text-box>
                                                </div>
                                                <div>
                                                    <label for="website"
                                                        class="block text-sm font-medium text-gray-700 mb-1">Website</label>
                                                    <app-elearning-text-box id="website" formControlName="website"
                                                        placeholder="Ví dụ: https://myportfolio.com" [error]="contactInfoForm.get('website')?.invalid && contactInfoForm.get('website')?.touched ? 
          'URL website không hợp lệ' : ''">
                                                    </app-elearning-text-box>
                                                </div>
                                            </div>

                                            <div>
                                                <div class="flex justify-between items-center mb-2">
                                                    <label class="block text-sm font-medium text-gray-700">Mạng xã
                                                        hội</label>
                                                    <button type="button" (click)="addSocialLink()"
                                                        class="text-sm text-blue-600 hover:text-blue-800">
                                                        + Thêm liên kết
                                                    </button>
                                                </div>

                                                <div formArrayName="socialLinks" class="space-y-3">
                                                    <div *ngFor="let link of socialLinksFormArray.controls; let i = index"
                                                        [formGroupName]="i" class="flex items-center gap-2">
                                                        <div class="w-1/3">
                                                            <select formControlName="platform"
                                                                class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                                                <option value="linkedin">LinkedIn</option>
                                                                <option value="github">GitHub</option>
                                                                <option value="twitter">Twitter</option>
                                                                <option value="other">Khác</option>
                                                            </select>
                                                        </div>
                                                        <div class="flex-grow">
                                                            <app-elearning-text-box formControlName="url"
                                                                placeholder="URL" [error]="link.get('url')?.invalid && link.get('url')?.touched ? 
              'URL không hợp lệ' : ''">
                                                            </app-elearning-text-box>
                                                        </div>
                                                        <button type="button" (click)="removeSocialLink(i)"
                                                            class="text-gray-400 hover:text-red-500 p-2">
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                                                viewBox="0 0 20 20" fill="currentColor">
                                                                <path fill-rule="evenodd"
                                                                    d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                                    clip-rule="evenodd" />
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>

                                <!-- Resume Sections -->
                                <ng-container *ngIf="activeSectionTab === 'all'">
                                    <div *ngFor="let section of currentResume.sections; let i = index" class="mb-8">
                                        <div class="flex justify-between items-center mb-4">
                                            <div class="flex items-center">
                                                <h3 class="text-lg font-medium text-gray-900">{{ section.title }}</h3>
                                                <button (click)="editSection(section)"
                                                    class="ml-2 text-gray-400 hover:text-blue-500">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4"
                                                        viewBox="0 0 20 20" fill="currentColor">
                                                        <path
                                                            d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="flex items-center">
                                                <button (click)="toggleSectionVisibility(section)"
                                                    class="text-gray-400 hover:text-gray-600 mr-2">
                                                    <svg *ngIf="section.isVisible" xmlns="http://www.w3.org/2000/svg"
                                                        class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                                                        <path fill-rule="evenodd"
                                                            d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                    <svg *ngIf="!section.isVisible" xmlns="http://www.w3.org/2000/svg"
                                                        class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd"
                                                            d="M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-4.512 1.074l-1.78-1.781zm4.261 4.26l1.514 1.515a2.003 2.003 0 012.45 2.45l1.514 1.514a4 4 0 00-5.478-5.478z"
                                                            clip-rule="evenodd" />
                                                        <path
                                                            d="M12.454 16.697L9.75 13.992a4 4 0 01-3.742-3.741L2.335 6.578A9.98 9.98 0 00.458 10c1.274 4.057 5.065 7 9.542 7 .847 0 1.669-.105 2.454-.303z" />
                                                    </svg>
                                                </button>
                                                <button (click)="moveSection(i, i - 1)" [disabled]="i === 0"
                                                    [class.text-gray-300]="i === 0"
                                                    class="text-gray-400 hover:text-gray-600 mr-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                                        viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd"
                                                            d="M5.293 7.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L6.707 7.707a1 1 0 01-1.414 0z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                </button>
                                                <button (click)="moveSection(i, i + 1)"
                                                    [disabled]="i === currentResume.sections.length - 1"
                                                    [class.text-gray-300]="i === currentResume.sections.length - 1"
                                                    class="text-gray-400 hover:text-gray-600 mr-2">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                                        viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd"
                                                            d="M14.707 12.293a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l2.293-2.293a1 1 0 011.414 0z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                </button>
                                                <button (click)="deleteSection(section.id)"
                                                    class="text-gray-400 hover:text-red-500">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5"
                                                        viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd"
                                                            d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                                                            clip-rule="evenodd" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>